@model IoT_Web.Models.Maquines.BasesModel

<link rel="stylesheet" href="~/Content/Overlay.css" />
<link rel="stylesheet" href="~/Content/DataTableCustom.css" />
<link rel="stylesheet" href="~/Content/FonsGrafiques.css" />

<div class="container backgroundGraphics" id="containerProducte">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseProducte" href="#collapseProducte" aria-expanded="false" aria-controls="collapseProducte">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.Producte</p>
    <div id="collapseProducte" class="collapse show">
        <div class="row">
            <div class="col" id="chartProducte" style="min-height: 170px; max-height:170px;">
            </div>
        </div>
    </div>

</div>

<div class="container backgroundGraphics" id="containerEstatVisio">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseEstatVisio" href="#collapseEstatVisio" aria-expanded="false" aria-controls="collapseEstatVisio">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.VisioEstats</p>
    <div id="collapseEstatVisio" class="collapse show">
        <div class="row">
            <div class="col" id="chartEstatsVisio" style="min-height: 170px; max-height:170px;">
            </div>
        </div>
    </div>

</div>

<div class="container backgroundGraphics" id="containerEstatRebutjador">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseEstatRebutjador" href="#collapseEstatRebutjador" aria-expanded="false" aria-controls="collapseEstatRebutjador">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.RebutjadorEstats</p>
    <div id="collapseEstatRebutjador" class="collapse show">
        <div class="row">
            <div class="col" id="chartEstatsRebutjador" style="min-height: 170px; max-height:170px;">
            </div>
        </div>
    </div>
</div>

<div class="container backgroundGraphics" id="containerEstatErrors">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseEstatErrors" href="#collapseEstatErrors" aria-expanded="false" aria-controls="collapseEstatErrors">
    </a>
    <p style="font-size:20px;">Activador Rebuig</p>
    <div id="collapseEstatErrors" class="collapse show">
        <div class="row">
            <div class="col" id="chartEstatsErrors" style="min-height: 170px; max-height:170px;">
            </div>
        </div>
    </div>
</div>

<div class="container backgroundGraphics" id="containerEstats">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseEstats" href="#collapseEstats" aria-expanded="false" aria-controls="collapseEstats">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.MaquinaEstats</p>
    <div id="collapseEstats" class="collapse show">
        <div class="row">
            <div class="col" id="chartContainer" style="min-height: 170px; max-height:170px;">
            </div>
        </div>
    </div>

</div>

<div id="noData" style="display: none; margin-top:200px;margin-bottom:200px;">
    <p align="center">@Recursos.Idioma.NoDades</p>
</div>

<div class="container backgroundGraphics" id="containerPercentatgeEstats">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapsePercentatgeEstats" href="#collapsePercentatgeEstats" aria-expanded="false" aria-controls="collapsePercentatgeEstats">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.PercentatgeEstats</p>
    <div id="collapsePercentatgeEstats" class="collapse show">
        <div class="row" id="divCircularChartContainer" style="padding-bottom: 35px; padding-top: 20px;margin-top:20px;">
            <div class="col" id="CircularChartContainer" style="min-width: 300px;min-height: 300px;">
            </div>
            <div class="col" id="TableTotalTimeStates" style="min-width: 300px; margin-right:2%;">
                <div class="col" style="border-radius:10px;">
                    <table class="table" style="border-radius:10px;">
                        <thead style="background:linear-gradient(205deg, #B8C9CD, #D5E2E4);">
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">@Recursos.Idioma.Estat</th>
                                <th scope="col">@Recursos.Idioma.Temps</th>
                                <th scope="col">%</th>
                            </tr>
                        </thead>
                        <tbody style="background:white;">
                            @foreach (var estat in Model.VBases.EstatsFrequents)
                            {
                                <tr>
                                    <td style="display:inline-block; width: 15px; margin-top: 10px; margin-bottom: 10px; border: 1px solid black; margin-left: 10px; border-radius: 10px;" bgcolor="@estat.Color"></td>
                                    <td title="@estat.Estat">@estat.Estat</td>
                                    <td>@(estat.Duracio.Days * 24 + estat.Duracio.Hours)h @estat.Duracio.Minutes.ToString()min @estat.Duracio.Seconds.ToString()s</td>
                                    <td>@estat.Percentatge.ToString() %</td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="container backgroundGraphics" id="containerResumProduccio">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseResumProduccio" href="#collapseResumProduccio" aria-expanded="false" aria-controls="collapseResumProduccio">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.InformacioGeneral</p>
    <div id="collapseResumProduccio" class="collapse show">
        <div class="row justify-content-center" id="divVisio" style="padding-bottom: 35px; padding-top: 20px;">
            <div class="col col-auto" id="TableEstadistica" style="width: 90%; min-width: 300px; ">

                <div class="col" style="border-radius:10px;">
                    <table class="table" style="border-radius:10px;">
                        <thead style="background:linear-gradient(205deg, #B8C9CD, #D5E2E4);">
                            <tr>
                                <th colspan="4" style="text-align: center;">@Recursos.Idioma.ResumProduccio</th>
                            </tr>
                        </thead>
                        <tbody style="background:white;">
                            <tr>
                                <td>
                                    @Recursos.Idioma.TotalProductesProduits:
                                </td>
                                <td>
                                    @Model.VBases.Comptadors.ProductesTotals
                                </td>
                                <td>
                                    @Recursos.Idioma.Cadencia:
                                </td>
                                @if (Model.VBases.Estats.Count() > 0 && Model.VBases.EstatsFrequents.Any(e => e.EstatId == 1))
                                {
                                    TimeSpan estat = Model.VBases.EstatsFrequents.Find(e => e.EstatId == 1).Duracio;
                                    double minutsTotals = estat.Days * 24 * 60 + estat.Hours * 60 + estat.Minutes;
                                    double prodTotals = Model.VBases.Estats.Last().ProductesTotals;
                                    string result;
                                    if (minutsTotals < 1)
                                    {
                                        result = $"{Math.Round(prodTotals / 1, 2).ToString()} productes/minut";
                                    }
                                    else
                                    {
                                        result = $"{Math.Round(prodTotals / minutsTotals, 2).ToString()} productes/minut";
                                    }
                                    <td>@result</td>
                                }
                                else
                                {
                                    string result = "0 productes/minut";
                                    <td>@result</td>
                                }
                            </tr>
                            <tr>
                                <td>
                                    @Recursos.Idioma.Acceptats:
                                </td>
                                <td>
                                    @Model.VBases.Comptadors.ProductesAcceptats
                                </td>
                                <td>
                                    @Recursos.Idioma.Rebutjats:
                                </td>
                                <td>
                                    @Model.VBases.Comptadors.ProductesRebutjats
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container backgroundGraphics" id="containerInformacioVisio" style="display:none;">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseInformacioVisio" href="#collapseInformacioVisio" aria-expanded="false" aria-controls="collapseInformacioVisio">
    </a>
    <p style="font-size:20px;">Vision Information</p>
    <div id="collapseInformacioVisio" class="collapse show">
        @foreach (var ErrorsProjecte in Model.VBases.ErrorsPerProjecte)
        {
            <div class="row" style="border-radius:10px;">
                <div class="col" style="border-radius:10px;">
                    <table class="table table-striped table-hover" style="border-radius:10px;">
                        <thead style="background:linear-gradient(205deg, #B8C9CD, #D5E2E4);">
                            <tr>
                                <th scope="col" style="width:20%;"><strong>@ErrorsProjecte.Projecte</strong></th>
                                <th scope="col">Via 1</th>
                                <th scope="col">Via 2</th>
                                <th scope="col">Via 3</th>
                                <th scope="col">Via 4</th>
                                <th scope="col">Via 5</th>
                                <th scope="col">Via 6</th>
                                <th scope="col">Via 7</th>
                                <th scope="col">Via 8</th>
                            </tr>
                        </thead>
                        <tbody style="background:white;">
                            <tr>
                                <th scope="row">General</th>
                                <td>@ErrorsProjecte.Via_1.RebuigGeneral</td>
                                <td>@ErrorsProjecte.Via_2.RebuigGeneral</td>
                                <td>@ErrorsProjecte.Via_3.RebuigGeneral</td>
                                <td>@ErrorsProjecte.Via_4.RebuigGeneral</td>
                                <td>@ErrorsProjecte.Via_5.RebuigGeneral</td>
                                <td>@ErrorsProjecte.Via_6.RebuigGeneral</td>
                                <td>@ErrorsProjecte.Via_7.RebuigGeneral</td>
                                <td>@ErrorsProjecte.Via_8.RebuigGeneral</td>
                            </tr>
                            <tr>
                                <th scope="row">MaxVision</th>
                                <td>@ErrorsProjecte.Via_1.RebuigMaxVision</td>
                                <td>@ErrorsProjecte.Via_2.RebuigMaxVision</td>
                                <td>@ErrorsProjecte.Via_3.RebuigMaxVision</td>
                                <td>@ErrorsProjecte.Via_4.RebuigMaxVision</td>
                                <td>@ErrorsProjecte.Via_5.RebuigMaxVision</td>
                                <td>@ErrorsProjecte.Via_6.RebuigMaxVision</td>
                                <td>@ErrorsProjecte.Via_7.RebuigMaxVision</td>
                                <td>@ErrorsProjecte.Via_8.RebuigMaxVision</td>
                            </tr>
                            <tr>
                                <th scope="row">Serigrafia</th>
                                <td>@ErrorsProjecte.Via_1.RebuigSerigrafia</td>
                                <td>@ErrorsProjecte.Via_2.RebuigSerigrafia</td>
                                <td>@ErrorsProjecte.Via_3.RebuigSerigrafia</td>
                                <td>@ErrorsProjecte.Via_4.RebuigSerigrafia</td>
                                <td>@ErrorsProjecte.Via_5.RebuigSerigrafia</td>
                                <td>@ErrorsProjecte.Via_6.RebuigSerigrafia</td>
                                <td>@ErrorsProjecte.Via_7.RebuigSerigrafia</td>
                                <td>@ErrorsProjecte.Via_8.RebuigSerigrafia</td>
                            </tr>
                            <tr>
                                <th scope="row">Data i Lot</th>
                                <td>@ErrorsProjecte.Via_1.RebuigDataLot</td>
                                <td>@ErrorsProjecte.Via_2.RebuigDataLot</td>
                                <td>@ErrorsProjecte.Via_3.RebuigDataLot</td>
                                <td>@ErrorsProjecte.Via_4.RebuigDataLot</td>
                                <td>@ErrorsProjecte.Via_5.RebuigDataLot</td>
                                <td>@ErrorsProjecte.Via_6.RebuigDataLot</td>
                                <td>@ErrorsProjecte.Via_7.RebuigDataLot</td>
                                <td>@ErrorsProjecte.Via_8.RebuigDataLot</td>
                            </tr>
                            <tr>
                                <th scope="row">Sellat</th>
                                <td>@ErrorsProjecte.Via_1.RebuigSellat</td>
                                <td>@ErrorsProjecte.Via_2.RebuigSellat</td>
                                <td>@ErrorsProjecte.Via_3.RebuigSellat</td>
                                <td>@ErrorsProjecte.Via_4.RebuigSellat</td>
                                <td>@ErrorsProjecte.Via_5.RebuigSellat</td>
                                <td>@ErrorsProjecte.Via_6.RebuigSellat</td>
                                <td>@ErrorsProjecte.Via_7.RebuigSellat</td>
                                <td>@ErrorsProjecte.Via_8.RebuigSellat</td>
                            </tr>
                            <tr>
                                <th scope="row">Especific</th>
                                <td>@ErrorsProjecte.Via_1.RebuigEspecific</td>
                                <td>@ErrorsProjecte.Via_2.RebuigEspecific</td>
                                <td>@ErrorsProjecte.Via_3.RebuigEspecific</td>
                                <td>@ErrorsProjecte.Via_4.RebuigEspecific</td>
                                <td>@ErrorsProjecte.Via_5.RebuigEspecific</td>
                                <td>@ErrorsProjecte.Via_6.RebuigEspecific</td>
                                <td>@ErrorsProjecte.Via_7.RebuigEspecific</td>
                                <td>@ErrorsProjecte.Via_8.RebuigEspecific</td>
                            </tr>
                            <tr>
                                <th scope="row">Fatal</th>
                                <td>@ErrorsProjecte.Via_1.RebuigFatal</td>
                                <td>@ErrorsProjecte.Via_2.RebuigFatal</td>
                                <td>@ErrorsProjecte.Via_3.RebuigFatal</td>
                                <td>@ErrorsProjecte.Via_4.RebuigFatal</td>
                                <td>@ErrorsProjecte.Via_5.RebuigFatal</td>
                                <td>@ErrorsProjecte.Via_6.RebuigFatal</td>
                                <td>@ErrorsProjecte.Via_7.RebuigFatal</td>
                                <td>@ErrorsProjecte.Via_8.RebuigFatal</td>
                            </tr>
                            <tr>
                                <th scope="row">Total</th>
                                <td>@ErrorsProjecte.Via_1.RebuigTotal</td>
                                <td>@ErrorsProjecte.Via_2.RebuigTotal</td>
                                <td>@ErrorsProjecte.Via_3.RebuigTotal</td>
                                <td>@ErrorsProjecte.Via_4.RebuigTotal</td>
                                <td>@ErrorsProjecte.Via_5.RebuigTotal</td>
                                <td>@ErrorsProjecte.Via_6.RebuigTotal</td>
                                <td>@ErrorsProjecte.Via_7.RebuigTotal</td>
                                <td>@ErrorsProjecte.Via_8.RebuigTotal</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        }
    </div>
</div>

<div class="container backgroundGraphics" id="containerQuantitatProductes" style="display:none;">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseQuantitatProductes" href="#collapseQuantitatProductes" aria-expanded="false" aria-controls="collapseQuantitatProductes">
    </a>
    <p style="font-size:20px;">Quantitat productes</p>
    <div id="collapseInformacioVisio" class="collapse show">

        <div class="row" style="border-radius:10px;">
            <div class="col" style="border-radius:10px;">
                <table class="table table-striped table-hover" style="border-radius:10px;">
                    <thead style="background:linear-gradient(205deg, #B8C9CD, #D5E2E4);">
                        <tr>
                            <th scope="col" style="width:20%;"><strong>Nom projecte</strong></th>
                            <th scope="col" style="width:20%;"><strong>Quantitat producte</strong></th>
                            <th scope="col" style="width:20%;"><strong>Rebutjats</strong></th>
                        </tr>
                    </thead>
                    <tbody style="background:white;">
                        @foreach (var Projectes in Model.VBases.Estats.GroupBy(e => e.ProjecteId))
                        {
                            if (Projectes.Key != 0)
                            {
                                <tr>
                                    <th scope="row">@Model.VBases.InfosProjecte.FirstOrDefault(e => e.Key == Projectes.Key).Value.Nom</th>
                                    <td>@Projectes.Sum(e => e.ProductesFabricatsEstat)</td>
                                    @if (Model.VBases.Errors.Any(e => e.ProjecteId == Projectes.Key))
                                    {
                                        <td>@Model.VBases.Errors.Where(e => e.ProjecteId == Projectes.Key).Count()</td>
                                    }
                                    else
                                    {
                                        <td>0</td>
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<div class="container backgroundGraphics" id="containerCadencia">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseCadencia" href="#collapseCadencia" aria-expanded="false" aria-controls="collapseCadencia">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.Cadencia</p>
    <div id="collapseCadencia" class="collapse show">
        <div class="container" id="containerCadencia">
            <div class="row">
                <div class="col">
                    <div id="GraficLinealCadencia" style="min-width: 300px;min-height: 100px;">
                    </div>
                    <div style="text-align: center; display:none;" id="GraficLinealCadenciaCheckbox">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealCadenciaCheckbox1" onclick="ShowHideLine('d1GraficLinealCadencia', 'GraficLinealCadenciaCheckbox1');" checked>
                            <label class="form-check-label" for="GraficLinealCadenciaCheckbox1"><font color="#F08080">Picks</font></label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealCadenciaCheckbox2" onclick="ShowHideLine('d2GraficLinealCadencia', 'GraficLinealCadenciaCheckbox2');" checked>
                            <label class="form-check-label" for="GraficLinealCadenciaCheckbox2"><font color="#F0F080">Tendency</font></label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealCadenciaCheckbox3" onclick="ShowHideLine('d3GraficLinealCadencia', 'GraficLinealCadenciaCheckbox3');" checked>
                            <label class="form-check-label" for="GraficLinealCadenciaCheckbox3"><font color="blue">Average</font></label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealCadenciaCheckbox4" onclick="ShowHideLine('d3GraficLinealCadencia', 'GraficLinealCadenciaCheckbox4');" checked>
                            <label class="form-check-label" for="GraficLinealCadenciaCheckbox4"><font color="blue">Average</font></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container backgroundGraphics" id="containerProductesTotals">
    <a class="fa fa-minus-circle collapsed" data-toggle="collapse" data-parent="#collapseProductesTotals" href="#collapseProductesTotals" aria-expanded="false" aria-controls="collapseProductesTotals">
    </a>
    <p style="font-size:20px;">@Recursos.Idioma.ProductesTotals</p>
    <div id="collapseProductesTotals" class="collapse show">
        <div class="container" id="containerCaixesTotals">
            <div class="row">
                <div class="col">
                    <div id="GraficLinealProducte" style="min-width: 300px;min-height: 100px;">
                    </div>
                    <div style="text-align: center; display:none" id="GraficLinealProducteCheckbox">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealProducteCheckbox1" onclick="ShowHideLine('d1GraficLinealProducte', 'GraficLinealProducteCheckbox1');" checked>
                            <label class="form-check-label" for="GraficLinealProducteCheckbox1"><font color="#F08080">Picks</font></label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealProducteCheckbox2" onclick="ShowHideLine('d2GraficLinealProducte', 'GraficLinealProducteCheckbox2');" checked>
                            <label class="form-check-label" for="GraficLinealProducteCheckbox2"><font color="#F0F080">Tendency</font></label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealProducteCheckbox3" onclick="ShowHideLine('d3GraficLinealProducte', 'GraficLinealProducteCheckbox3');" checked>
                            <label class="form-check-label" for="GraficLinealProducteCheckbox3"><font color="blue">Average</font></label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="GraficLinealProducteCheckbox4" onclick="ShowHideLine('d3GraficLinealProducte', 'GraficLinealProducteCheckbox4');" checked>
                            <label class="form-check-label" for="GraficLinealProducteCheckbox4"><font color="blue">Average</font></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col text-center" style="margin: 15px;margin-top:20px;">
        <button id="Pdfbutton" type="button" class="btn" onclick="PDFBackend();"><img src="~/Images/pdfImage.png" width="180" height="60"></button>
    </div>
</div>


<script type="text/javascript" src="~/Scripts/JS_Formadora.js"></script>
<script type="text/javascript" src="~/PDF/GestorPDF.js"></script>
<script type="text/javascript" src="~/PDF/jquery.color-animation.js"></script>
<script>
    var machine = "@Model.VBases.Nom";

    $(document).ready(function () {
        $("li").removeAttr("style");
        $("a[href$='" + machine + "']").attr("style", "background-color:#525252");

        if ($("a[href$='" + machine + "']").parent().get(0).tagName == "LI") {
            $("a[href$='" + machine + "']").parents(':eq(1)').toggleClass("show");
        }

        //Actualitzem la durada
        refreshDuration();

        //JS Primera gràfica
        var table = $('#taulaAlarmesId').DataTable({
            "dom": '<"top"fl>rt<"bottom"ip><"clear">',
            "language": {
                "sProcessing": "@Recursos.Idioma.Processant",
                "sLengthMenu": "@Recursos.Idioma.MostrarMenu",
                "sZeroRecords": "@Recursos.Idioma.SenseResultats",
                "sEmptyTable": "@Recursos.Idioma.TaulaBuida",
                "sInfo": "@Recursos.Idioma.InfoTaula",
                "sInfoEmpty": "@Recursos.Idioma.InfoBuida",
                "sInfoFiltered": "@Recursos.Idioma.InfoFiltrada",
                "sInfoPostFix": "",
                "sSearch": "@Recursos.Idioma.Buscar",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "@Recursos.Idioma.CarregantDades",
                "oPaginate": {
                    "sFirst": "@Recursos.Idioma.Primer",
                    "sLast": "@Recursos.Idioma.Ultim",
                    "sNext": "@Recursos.Idioma.Seguent",
                    "sPrevious": "@Recursos.Idioma.Anterior"
                },
                "oAria": {
                    "sSortAscending": "@Recursos.Idioma.OrdreAscendent",
                    "sSortDescending": "@Recursos.Idioma.OrdreDescendent"
                }
            },
            "pagingType": "full_numbers"
        });
        $('.dataTables_length').addClass('bs-select')
        $('#ShowAll').click(function () {
            table.search('').draw();
            $().val('');
        });
    });

    var interval;
    var minuteNumber = 0;
    //reset visibilitat divs
    $('#noData').hide();
    $('#TableVariables').hide();
    $('#TableTotalTimeStates').show();

    $('#Pdfbutton').hide();

    var estatsJson = CrearDates(@Html.Raw(Model.VBases.EstatsJson));
    //Actualitzem la navbarSupportedContent per tal de dividir les gràfiques
    ActualitzarNavbar();

    if (estatsJson) {

        var estatsMaquinaJson = CrearDates(@Html.Raw(Model.VBases.EstatsMaquinaJson));
        var estatsVisioJson = CrearDates(@Html.Raw(Model.VBases.EstatsVisioJson));
        var estatsRebutjadorJson = CrearDates(@Html.Raw(Model.VBases.EstatsRebutjadorJson));
        var canviProducteJson = CrearDates(@Html.Raw(Model.VBases.CanviProducteJson));
        var estatsErrorsJson = CrearDates(@Html.Raw(Model.VBases.ErrorsJson));

        var minimumDate = moment("@Html.Raw(Model.VBases.DataMinima).ToString()", "YYYY/MM/DD HH:mm:ss");
        var maximumDate = moment("@Html.Raw(Model.VBases.DataMaxima).ToString()", "YYYY/MM/DD HH:mm:ss");

        var iniciData = moment("@Model.VBases.Inici", "DD/MM/YYYY HH:mm:ss").format("YYYY/MM/DD HH:mm:ss");
        var finalData = moment("@Model.VBases.Final", "DD/MM/YYYY HH:mm:ss").format("YYYY/MM/DD HH:mm:ss");

        var iniciDataAnterior = moment("@Html.Raw(Model.VBases.IniciAnteriorStr).ToString()", "YYYY/MM/DD HH:mm:ss");
        var finalDataAnterior = moment("@Html.Raw(Model.VBases.FinalAnteriorStr).ToString()", "YYYY/MM/DD HH:mm:ss");

        var llistaEstatsFrequents = @Html.Raw(Json.Encode(Model.VBases.EstatsFrequents));

        var lineArr = [];
        var MAX_LENGTH = 600; //numero de punts3000
        var duration = 100; //interval entre updates de la grafica (en milisegons)600

        barchart(canviProducteJson, true, "#chartProducte", iniciData, finalData, "Estat", null, "Color", machine, "Bases");
        barchart(estatsVisioJson, true, "#chartEstatsVisio", iniciData, finalData, "Estat", null, "Color", machine, "Bases");
        barchart(estatsRebutjadorJson, true, "#chartEstatsRebutjador", iniciData, finalData, "Estat", null, "Color", machine, "Bases");
        barchart(estatsMaquinaJson, true, "#chartContainer", iniciData, finalData, "Estat", null, "Color", machine, "Bases");
        barchart(estatsErrorsJson, true, "#chartEstatsErrors", iniciData, finalData, "TextError", null, "Color", machine, "Bases");

        piechart("#CircularChartContainer", llistaEstatsFrequents, "Estat");

        linechart("@Recursos.Idioma.Cadencia", estatsJson, true, false, true, true, "#GraficLinealCadencia", "Cadencia", iniciData, finalData, estatsJson, "Color");
        //linechart("@Recursos.Idioma.Cadencia", estatsJson, true, false, true, true, "#GraficLinealCadencia", "Cadencia", iniciData, finalData);
        //linechart("@Recursos.Idioma.Producte", estatsJson, true, false, true, true, "#GraficLinealProducte", "ProductesTotals", iniciData, finalData);

        showCheckboxes();//Mostrem els checkboxes de les gràfiques

        $('#Pdfbutton').show();
    }
    else {
        $('#noData').show();
        $('#containerPercentatgeEstats').hide();
        $('#divVisio').hide();
        hideGraphics();
    }
    $('#divPercentatgeAlarmes').hide();
    $("#divLoading").hide();



    function ActualitzarNavbar(){
        $('#navbarSupportedContent').find('a').remove();
        $("#navbarSupportedContent").prepend("<a onclick='ShowVisio();' href='#' class='nav-item nav-link' style='margin-right:10px;'><i class='fa fa-eye pull-left' style='margin-top:5%;'></i>@Recursos.Idioma.Visio</a>");
        //$("#navbarSupportedContent").prepend("<a onclick='hideGraphics();' href='#' class='nav-item nav-link' style='margin-right:10px;'><i class='fa fa-bell pull-left' style='margin-top:2%;'></i>@Recursos.Idioma.LlistaAlarmes</a>");
        $("#navbarSupportedContent").prepend("<a onclick='showGraphics();' href='#' class='nav-item nav-link' style='margin-right:10px'><i class='fa fa-bar-chart pull-left' style='margin-top:5%;'></i>@Recursos.Idioma.General</a>");
    }

    function seedData() {//valors inicials de realtimeChart
        var endOfDate = (iniciData._i.split("/"))
        var endNow = new Date(endOfDate[1] + "/" + endOfDate[0] + "/" + endOfDate[2])

        for (var i = 0; i < MAX_LENGTH; ++i) {
            lineArr.push({
                time: new Date(endNow.getTime() - ((MAX_LENGTH - i) * duration)),
                z: 0
            });
        }
    }

    function CrearDates(jsonObj) {
        for (var i in jsonObj) {
            jsonObj[i].Inici = new Date(jsonObj[i].Inici);
            jsonObj[i].Final = new Date(jsonObj[i].Final);
        }
        return jsonObj;
    }

    function hideGraphics() {
        $('#containerProducte').hide();
        $('#containerEstatVisio').hide();
        $('#containerEstatRebutjador').hide();
        $('#containerEstats').hide();
        $('#containerPercentatgeEstats').hide();
        $('#containerCadencia').hide();
        $('#containerProductesTotals').hide();
        $('#Pdfbutton').hide();
        $('#divPercentatgeAlarmes').show();
        $('#TableVariables').hide();
        $('#tableContentVariables').hide();
        $('#GraficLinealCadenciaCheckbox').hide();
        $('#GraficLinealProducteCheckbox').hide();
        $('#divVisio').hide();
        $('#containerResumProduccio').hide();
    }

    function showGraphics() {
        if (estatsJson.length > 0) { //Per mantenir l'estructura de la pàgina, altrament es farà més petita i es solapen els elements.
            $('#containerProducte').show();
            $('#containerEstatVisio').show();
            $('#containerEstatRebutjador').show();
            $('#containerEstats').show();
            $('#containerResumProduccio').show();
            $('#containerPercentatgeEstats').show();
            $('#containerCadencia').show();
            $('#containerProductesTotals').show();
            $('#Pdfbutton').show();
            $('#divPercentatgeAlarmes').hide();
            $('#TableVariables').hide();
            $('#tableContentVariables').hide();
            $('#chartContainer3').hide();
            $('#divVisio').show();
            $('#containerInformacioVisio').hide();
            $('#containerQuantitatProductes').hide();
            showCheckboxes();
        }
    }

    function showVariables() {
        if (estatsJson.length > 0 ) {
            hideGraphics();
            $('#TableVariables').show();
            $('#chartContainer3').show();
            $('#tableContentVariables').hide();
            $('#GraficLinealCadenciaCheckbox').hide();
            $('#GraficLinealProducteCheckbox').hide();
            $('#camaras').hide();
            $('#divVisio').hide();
        }
    }

    function showCamaras() {
        if (estatsJson.length > 0) {
            hideGraphics();
            $('#TableVariables').hide();
            $('#chartContainer3').hide();
            $('#camaras').show();
            $('#divVisio').hide();
        }
    }

    function ShowVisio() {
        if (estatsJson.length > 0) {
            hideGraphics();
            $('#containerInformacioVisio').show();
            $('#containerQuantitatProductes').show();
        }
    }
    function addVariablesToTable(data, idJson, nameProduct) {
        var innerHtml = "";
        var counter = 0;
        Object.keys(data).forEach(function (key) {
            var dataObj = data[key];
            Object.keys(dataObj).forEach(function (key2) {
                if (key2 == "Timestamp") {
                    innerHtml = "<tr class='row100 body'><td class='cell100 column1'>" + dataObj[key2] + "</td><td class='cell100 column2' style='width:auto'>" + nameProduct + "</td><td class='cell100 column3'><a onclick='addFormadora_DConfig(" + counter + "," + idJson + ")'>click me</a></td></tr>";
                    $('#tableVariableInfo').find('tbody').prepend(innerHtml);
                    counter = counter + 1;
                    return;
                }
            })
        })
    }

    function showCheckboxes() {
        $('#GraficLinealCadenciaCheckbox').show();
        $('#GraficLinealProducteCheckbox').show();
    }

    function ShowHideLine(div_id, checkboxId) {
        if (document.body.contains(document.getElementById(div_id))) {
            if (document.getElementById(div_id).style.opacity == 1 && $("input[id^='" + checkboxId.substring(0, checkboxId.length - 1) + "']:checked").length > 1) {//Esta actiu, el desactivem
                d3.select("#" + div_id).style("opacity", 0);
                document.getElementById(checkboxId).checked = false;
            }
            else {
                d3.select("#" + div_id).style("opacity", 1);
                document.getElementById(checkboxId).checked = true;
            }
        }
    }

    function increaseZoom() {
        if (estatsJson) {
            var oldDateStart = "@Html.Raw(Model.VBases.Inici).ToString()";
            var oldDateEnd = "@Html.Raw(Model.VBases.Final).ToString()";

            var dateEnd = oldDateEnd.split("/");
            var dateStart = oldDateStart.split("/");

            var milisecondsEnd = Date.parse(dateEnd[1] + "/" + dateEnd[0] + "/" + dateEnd[2]);
            var milisecondsStart = Date.parse(dateStart[1] + "/" + dateStart[0] + "/" + dateStart[2]);

            var newDateMilli = milisecondsStart + ((milisecondsEnd - milisecondsStart) / 10);
            var newDate = new Date(newDateMilli);
            var newDateSplit = newDate.toString().split(" ");

            var test = newDateSplit[2] + "/" + returnMonthNumber(newDateSplit[1]) + "/" + newDate.getFullYear() + " " + newDate.getHours() + ":" + newDate.getMinutes() + ":" + newDate.getSeconds();

            $("#divLoading").show();
            var antInitDate = document.getElementById("dataInicial").value;
            var antFinalDate = document.getElementById("dataFinal").value;
            var list = document.getElementById('shiftDropDownList');
            var selectedShift = list.options[list.selectedIndex].value;
            $("#partial").load("/Bases/BasesPartial", { inici: test, final: antFinalDate, torn: selectedShift, iniciAnt: antInitDate, finalAnt: antFinalDate, nomMaquina: machine  });
        }
    }

    function previosZoom() {
        if (estatsJson) {
            $("#divLoading").show();
            document.getElementById("dataInicial").value = iniciDataAnterior._i;
            document.getElementById("dataFinal").value = finalDataAnterior._i;
            var list = document.getElementById('shiftDropDownList');
            var selectedShift = list.options[list.selectedIndex].value;
            $("#partial").load("/Bases/BasesPartial", { inici: iniciDataAnterior._i, final: finalDataAnterior._i, torn: selectedShift, iniciAnt: minimumDate._i, finalAnt: maximumDate._i, nomMaquina: machine });
        }
    }

    function returnMonthNumber(monthname) {
        var monthShortNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
        ];
        var month = monthShortNames.indexOf(monthname);
        return month ? month + 1 : 0;
    }

    function refreshDuration() {
        var newDataIn = new Date(moment("@Html.Raw(Model.VBases.Inici).ToString()", "DD/MM/YYYY HH:mm:ss"));
        var newDataFi = new Date(moment("@Html.Raw(Model.VBases.Final).ToString()", "DD/MM/YYYY HH:mm:ss"));
        var duration = convertMSGrafica(Math.abs(newDataFi.getTime() - newDataIn.getTime()));
        var newDuration = "@Html.Raw(Recursos.Idioma.Duracio)" + ": " + duration;
        $("#textDurada").text(newDuration);
        document.getElementById('dataInicial').value = "@Html.Raw(Model.VBases.Inici.ToString())";
        document.getElementById('dataFinal').value = "@Html.Raw(Model.VBases.Final.ToString())";
    }

    function PDFBackend() {
        window.location.href = "@Html.Raw(@Url.Action("GenerarPDF", "Bases", new { nomMaquina=@Model.VBases.Nom, inici=@Model.VBases.Inici.ToString(), final=@Model.VBases.Final.ToString(), torn=0 }))";
    }

    $("a").click(function () {
        if ($(this).hasClass("fa-minus-circle")) {
            $(this).removeClass("fa-minus-circle");
            $(this).addClass("fa-plus-circle");
        }
        else if($(this).hasClass("fa-plus-circle")) {
            $(this).removeClass("fa-plus-circle");
            $(this).addClass("fa-minus-circle");
        }
    });

</script>
